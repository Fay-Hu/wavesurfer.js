/*! wavesurfer.js 1.4.0A (June 22, 2017)
* https://github.com/katspaugh/wavesurfer.js
* (modifications) https://github.com/agamemnus/wavesurfer.js
* @license BSD-3-Clause */
!function(t,e){"function"==typeof define&&define.amd?define("wavesurfer",[],function(){return t.WaveSurfer=e()}):"object"==typeof exports?module.exports=e():t.WaveSurfer=e()}(this,function(){"use strict";var t={defaultParams:{audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",barHeight:1,classList:{},styleList:{wave:{},progressWave:{},cursor:{}},closeAudioContext:!1,container:null,cursorAlignment:"middle",cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillColor:void 0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,invertTransparency:!1,loopSelection:!0,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,progressColor:"#555",normalize:!1,renderer:"MultiCanvas",scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999"},init:function(e){var i=this,a=Object.assign({},i.defaultParams),s=function(t){i.drawer&&i.drawer.updateCursorPosition()},r=function(){i.drawer&&i.drawBuffer()};i.aliases={},i.aliases.cursorColor={target:{object:a.styleList.cursor,property:"_backgroundColor"},sourceList:[{object:a,property:"cursorColor"},{object:a.styleList.cursor,property:"backgroundColor"}]},i.aliases.cursorWidth={target:{object:a.styleList.cursor,property:"_width"},sourceList:[{object:a,property:"cursorWidth",get:function(t){return parseFloat(t)},set:function(t){return t+"px"},afterSet:s},{object:a.styleList.cursor,property:"width",afterSet:s}]},i.aliases.cursorAlignment={target:{object:a.styleList.cursor,property:"_cursorAlignment"},sourceList:[{object:a,property:"cursorAlignment",afterSet:s}]},["invertTransparency","backgroundColor","barWidth"].forEach(function(t){i.aliases[t]={target:{object:a,property:"_"+t},sourceList:[{object:a,property:t,afterSet:r}]}}),["wave","progressWave"].forEach(function(t){["color","backgroundColor"].forEach(function(e){var s="wave"==t?"wave":"progress",n=e[0].toUpperCase()+e.slice(1);i.aliases[t+n]={target:{object:a.styleList[t],property:"_"+e},sourceList:[{object:a,property:s+n,afterSet:r},{object:a.styleList[t],property:e,afterSet:r}]}})}),t.util.refreshAliases(i.aliases);a=Object.assign(a,i.defaultParams);if(i.params=t.util.deepMerge(a,e),i.container="string"==typeof e.container?document.querySelector(i.params.container):i.params.container,!i.container)throw new Error("Container element not found");if(null==i.params.mediaContainer?i.mediaContainer=i.container:"string"==typeof i.params.mediaContainer?i.mediaContainer=document.querySelector(i.params.mediaContainer):i.mediaContainer=i.params.mediaContainer,!i.mediaContainer)throw new Error("Media Container element not found");i.savedVolume=0,i.isMuted=!1,i.tmpEvents=[],i.currentAjax=null,i.createDrawer(),i.createBackend(),i.createPeakCache(),i.isDestroyed=!1,i.on("ready",function(){i.audioIsReady=!0,void 0!==i.backend.lastClickPosition&&i.seekTo(i.backend.lastClickPosition)})},createDrawer:function(){var e=this;e.drawer=Object.create(t.Drawer[e.params.renderer]),e.drawer.init(e.container,e.params,e.aliases,e),e.drawer.on("redraw",function(){e.drawBuffer(function(){e.drawer.progress(e.backend.getPlayedPercents())})}),e.drawer.on("click",function(t,i){setTimeout(function(){e.seekTo(i)},0)}),e.drawer.on("scroll",function(t){e.params.partialRender?e.drawBuffer(function(){e.fireEvent("scroll",t)}):e.fireEvent("scroll",t)})},createBackend:function(){var e=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||t.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement"),this.backend=Object.create(t[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){e.fireEvent("finish")}),this.backend.on("play",function(){e.fireEvent("play")}),this.backend.on("pause",function(){e.fireEvent("pause")}),this.backend.on("audioprocess",function(t){e.drawer.progress(e.backend.getPlayedPercents()),e.fireEvent("audioprocess",t)})},createPeakCache:function(){this.params.partialRender&&(this.peakCache=Object.create(t.PeakCache),this.peakCache.init())},getDuration:function(){return this.audioIsReady||void 0===this.cachedData||void 0===this.cachedData.duration?this.backend.getDuration():this.cachedData.duration},getCurrentTime:function(){return this.audioIsReady||void 0===this.cachedData||void 0===this.cachedData.duration?this.backend.getCurrentTime():this.lastClickPosition*this.cachedData.duration},play:function(t,e){function i(){a.fireEvent("interaction",a.play.bind(a,t,e)),a.backend.play(t,e)}var a=this;return 1==a.audioIsReady?(i(),!0):(this.tmpEvents.push(this.once("ready",i)),!1)},pause:function(){return this.backend.isPaused()||this.backend.pause()},playPause:function(){return this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(t){this.skip(-t||-this.params.skipLength)},skipForward:function(t){this.skip(t||this.params.skipLength)},skip:function(t){var e=this.getCurrentTime()||0,i=this.getDuration()||1;e=Math.max(0,Math.min(i,e+(t||0))),this.seekAndCenter(e/i)},seekAndCenter:function(t){this.seekTo(t),this.drawer.recenter(t)},seekTo:function(t){this.lastClickPosition=t,this.fireEvent("interaction",this.seekTo.bind(this,t));var e=this.backend.isPaused();e||this.backend.pause();var i=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(t*this.getDuration()),this.drawer.progress(t),e||this.backend.play(),this.params.scrollParent=i,this.fireEvent("seek",t)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(t){this.backend.setVolume(t)},getVolume:function(){return this.backend.getVolume()},setPlaybackRate:function(t){this.backend.setPlaybackRate(t)},getPlaybackRate:function(){return this.backend.getPlaybackRate()},toggleMute:function(){this.setMute(!this.isMuted)},setMute:function(t){t!==this.isMuted&&(t?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0):(this.backend.setVolume(this.savedVolume),this.isMuted=!1))},getMute:function(){return this.isMuted},getFilters:function(){return this.backend.filters||[]},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},getNumberOfChannels:function(){return this.backend.buffer?this.backend.buffer.numberOfChannels:this.cachedData&&void 0!==this.cachedData.numberOfChannels?this.cachedData.numberOfChannels:this.backend.peaks[0]instanceof Array?this.backend.peaks.length:2},getComputedWidthAndRange:function(){var t=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),e=this.drawer.getWidth();if(this.params.fillParent&&(!this.params.scrollParent||t<e))var i=0,a=s=e;else var s=t,i=this.drawer.getScrollX(),a=Math.min(i+e,s);return{width:s,start:i,end:a}},drawBuffer:function(t){var e=this.getComputedWidthAndRange(),i=e.width,a=e.start,s=e.end,r=this;if(r.params.partialRender)var n=r.peakCache.addRangeToPeakCache(i,a,s),o=function(t){for(var e=0;e<n.length;e++)t(r.backend.getPeaks(i,n[e][0],n[e][1]),i,n[e][0],n[e][1])};else{if("peaks"in r.backend)var h=r.getNumberOfChannels(),c=(r.backend.peaks[0]instanceof Array?r.backend.peaks[0].length:r.backend.peaks.length)/h;else c=i;a=0,s=c-1;o=r.backend.getPeaks(c,a,s)}r.drawer.drawPeaks(o,i,a,s,function(){t instanceof Function&&t(),r.fireEvent("redraw",o,i)})},zoom:function(t){this.params.minPxPerSec=t,this.params.scrollParent=!0;var e=this;this.drawBuffer(function(){e.drawer.updateProgress(),e.drawer.recenter(),e.fireEvent("zoom",t)})},loadArrayBuffer:function(t){this.decodeArrayBuffer(t,function(t){this.isDestroyed||this.loadDecodedBuffer(t)}.bind(this))},loadDecodedBuffer:function(t){var e=this;e.backend.load(t),e.drawBuffer(function(){e.fireEvent("ready")})},loadBlob:function(t){var e=this,i=new FileReader;i.addEventListener("progress",function(t){e.onProgress(t)}),i.addEventListener("load",function(t){e.loadArrayBuffer(t.target.result)}),i.addEventListener("error",function(){e.fireEvent("error","Error reading file")}),i.readAsArrayBuffer(t),this.empty()},load:function(t,e,i,a){var s=this,r=(a=a||{}).loadOnInteraction;"loadOnInteraction"in a&&delete a.loadOnInteraction,s.cachedData=a,s.empty({drawPeaks:void 0===e},function(){switch(s.isMuted=!1,s.params.backend){case"WebAudio":return s.loadBuffer(t,e,!0,r);case"MediaElement":return s.loadMediaElement(t,e,i)}})},loadBuffer:function(t,e,i,a){function s(){if(!a)return r.drawer.updateProgress(0),n();r.tmpEvents.push(r.once("interaction",function(t){n(t)}))}var r=this,n=function(e){return e&&r.tmpEvents.push(r.once("ready",e)),r.getArrayBuffer(t,r.loadArrayBuffer.bind(r))};e?(r.backend.setPeaks(e),r.drawBuffer(s)):s()},loadMediaElement:function(t,e,i){var a=t;if("string"==typeof t)this.backend.load(a,this.mediaContainer,e,i);else{var s=t;this.backend.loadElt(s,e),a=s.src}this.tmpEvents.push(this.backend.once("canplay",function(){var t=this;t.drawBuffer(function(){t.fireEvent("ready")})}.bind(this)),this.backend.once("error",function(t){this.fireEvent("error",t)}.bind(this))),e&&this.backend.setPeaks(e),e&&!this.params.forceDecode||!this.backend.supportsWebAudio()||this.getArrayBuffer(a,function(t){this.decodeArrayBuffer(t,function(t){var e=this;e.backend.buffer=t,e.backend.setPeaks(null),e.drawBuffer(function(){e.fireEvent("waveform-ready")})}.bind(this))}.bind(this))},decodeArrayBuffer:function(t,e){this.arraybuffer=t,this.backend.decodeArrayBuffer(t,function(i){this.isDestroyed||this.arraybuffer!=t||(e(i),this.arraybuffer=null)}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(e,i){var a=this,s=t.util.ajax({url:e,responseType:"arraybuffer"});return this.currentAjax=s,this.tmpEvents.push(s.on("progress",function(t){a.onProgress(t)}),s.on("success",function(t,e){i(t),a.currentAjax=null}),s.on("error",function(t){a.fireEvent("error","XHR error: "+t.target.statusText),a.currentAjax=null})),s},onProgress:function(t){if(t.lengthComputable)var e=t.loaded/t.total;else e=t.loaded/(t.loaded+1e6);this.fireEvent("loading",Math.round(100*e),t.target)},exportPCM:function(t,e,i,a){t=t||1024,e=e||1e4,i=i||!1;var s=this.backend.getPeaks(t,a,t-1),r=[].map.call(s,function(t){return Math.round(t*e)/e}),n=JSON.stringify(r);return i||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(n)),n},exportImage:function(t,e){return t||(t="image/png"),e||(e=1),this.drawer.getImage(t,e)},cancelAjax:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)},clearTmpEvents:function(){this.tmpEvents.forEach(function(t){t.un()})},empty:function(t,e){t=t||{},this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),"drawPeaks"in t&&1!=t.drawPeaks?e&&e():this.drawer.drawPeaks({length:this.drawer.getWidth()},0,void 0,void 0,e)},destroy:function(){this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0}};return t.create=function(e){var i=Object.create(t);return i.init(e),i},t.util={requestAnimationFrame:(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){setTimeout(t,1e3/60)}).bind(window),frame:function(e){return function(){var i=this,a=arguments;t.util.requestAnimationFrame(function(){e.apply(i,a)})}},extend:function(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){Object.keys(e).forEach(function(i){t[i]=e[i]})}),t},deepMerge:function(t,e,i){if(null===e||"object"!=typeof e||"isActiveClone"in e)return"object"!=typeof t?e:t;if(null===t||"object"!=typeof t)var t=e instanceof Date?new e.constructor:e.constructor();for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(e.isActiveClone=null,e[a]instanceof Element||void 0!==i&&0==i?t[a]=e[a]:t[a]=this.deepMerge(t[a],e[a],void 0===i?void 0:i-1),delete e.isActiveClone);return t},setAliases:function(t){var e=t.target.object,i=t.target.property;if(t.styleSource){var a=t.styleSource,s=a.set?function(t){r[n]=a.set(t)}:function(t){r[n]=t},r=a.object,n=a.property,o=n.replace(/([A-Z])/g,"-$1").toLowerCase();Object.defineProperty(r,n,{get:function(){return this.getPropertyValue(o)},set:function(t){e[i]=t,this.setProperty(o,t)}})}t.sourceList.forEach(function(t){if(t.get)a=function(){return t.get(e[i])};else var a=function(){return e[i]};var r=t.afterSet;if(s)n=r?function(t){s(t),r(t)}:s;else var n=r||void 0;if(t.set)if(n)o=function(a){a=e[i]=t.set(a),n(a)};else o=function(a){e[i]=t.set(a)};else if(n)o=function(t){t=e[i]=t,n(t)};else var o=function(t){e[i]=t};Object.defineProperty(t.object,t.property,{configurable:!0,get:a,set:o})})},refreshAliases:function(e,i){for(var a in e){var s=e[a];i&&i[a]&&t.util.deepMerge(s,i[a],1),t.util.setAliases(s)}},debounce:function(t,e,i){var a,s,r,n=function(){r=null,i||t.apply(s,a)};return function(){s=this,a=arguments;var o=i&&!r;clearTimeout(r),(r=setTimeout(n,e))||(r=setTimeout(n,e)),o&&t.apply(s,a)}},min:function(t){var e=1/0;for(var i in t)t[i]<e&&(e=t[i]);return e},max:function(t){var e=-1/0;for(var i in t)t[i]>e&&(e=t[i]);return e},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(e){var i=Object.create(t.Observer),a=new XMLHttpRequest,s=!1;return a.open(e.method||"GET",e.url,!0),a.responseType=e.responseType||"json",a.addEventListener("progress",function(t){i.fireEvent("progress",t),t.lengthComputable&&t.loaded==t.total&&(s=!0)}),a.addEventListener("load",function(t){s||i.fireEvent("progress",t),i.fireEvent("load",t),200==a.status||206==a.status?i.fireEvent("success",a.response,t):i.fireEvent("error",t)}),a.addEventListener("error",function(t){i.fireEvent("error",t)}),a.send(),i.xhr=a,i}},t.Observer={on:function(t,e){this.handlers||(this.handlers={});var i=this.handlers[t];return i||(i=this.handlers[t]=[]),i.push(e),{name:t,callback:e,un:this.un.bind(this,t,e)}},un:function(t,e){if(this.handlers){var i=this.handlers[t];if(i)if(e)for(var a=i.length-1;a>=0;a--)i[a]==e&&i.splice(a,1);else i.length=0}},unAll:function(){this.handlers=null},once:function(t,e){var i=this,a=function(){e.apply(this,arguments),setTimeout(function(){i.un(t,a)},0)};return this.on(t,a)},fireEvent:function(t){if(this.handlers){var e=this.handlers[t],i=Array.prototype.slice.call(arguments,1);e&&e.forEach(function(t){t.apply(null,i)})}}},t.util.extend(t,t.Observer),t.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){return t.WebAudio.audioContext||(t.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),t.WebAudio.audioContext},getOfflineAudioContext:function(e){return t.WebAudio.offlineAudioContext||(t.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),t.WebAudio.offlineAudioContext},init:function(e){this.params=e,this.ac=e.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states=[Object.create(t.WebAudio.state.playing),Object.create(t.WebAudio.state.paused),Object.create(t.WebAudio.state.finished)],this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(this.PAUSED_STATE),this.setPlaybackRate(this.params.audioRate),this.setLength(0)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(t){t&&t.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(t){this.state!==this.states[t]&&(this.state=this.states[t],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(t){this.disconnectFilters(),t&&t.length&&(this.filters=t,this.analyser.disconnect(),t.reduce(function(t,e){return t.connect(e),e},this.analyser).connect(this.gainNode))},createScriptNode:function(){this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(this.scriptBufferSize):this.scriptNode=this.ac.createJavaScriptNode(this.scriptBufferSize),this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var t=this;this.scriptNode.onaudioprocess=function(){var e=t.getCurrentTime();e>=t.getDuration()?(t.setState(t.FINISHED_STATE),t.fireEvent("pause")):e>=t.scheduledPause?t.pause():t.state===t.states[t.PLAYING_STATE]&&t.fireEvent("audioprocess",e)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(t){this.gainNode.gain.value=t},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(t,e,i){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(t,function(t){e(t)}.bind(this),i)},setPeaks:function(t){this.peaks=t},setLength:function(t){if(!this.mergedPeaks||t!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[],this.mergedPeaks=[];for(var e=this.buffer?this.buffer.numberOfChannels:1,i=0;i<e;i++)this.splitPeaks[i]=[],this.splitPeaks[i][2*(t-1)]=0,this.splitPeaks[i][2*(t-1)+1]=0;this.mergedPeaks[2*(t-1)]=0,this.mergedPeaks[2*(t-1)+1]=0}},getPeaks:function(t,e,i){if(e=e||0,i=i||t-1,this.peaks)return this.peaks;this.setLength(t);for(var a=this.buffer.length/t,s=~~(a/10)||1,r=this.buffer.numberOfChannels,n=0;n<r;n++)for(var o=this.splitPeaks[n],h=this.buffer.getChannelData(n),c=e;c<=i;c++){for(var l=~~(c*a),u=~~(l+a),d=0,p=0,f=l;f<u;f+=s){var m=h[f];p<m?p=m:d>m&&(d=m)}o[2*c]=p,o[2*c+1]=d,(0==n||p>this.mergedPeaks[2*c])&&(this.mergedPeaks[2*c]=p),(0==n||d<this.mergedPeaks[2*c+1])&&(this.mergedPeaks[2*c+1]=d)}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"==typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:t.WebAudio.audioContext=null,t.WebAudio.offlineAudioContext=null)},load:function(t){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=t,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(t,e){if(this.buffer)return this.scheduledPause=null,null==t&&(t=this.getCurrentTime())>=this.getDuration()&&(t=0),null==e&&(e=this.getDuration()),this.startPosition=t,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:t,end:e}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(t,e){if(this.buffer){this.lastClickPosition=void 0,this.createSource();var i=this.seekTo(t,e);t=i.start,e=i.end,this.scheduledPause=e,this.source.start(0,t,e-t),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(this.PLAYING_STATE),this.fireEvent("play")}},pause:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE),this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},getPlaybackRate:function(){return this.playbackRate},setPlaybackRate:function(t){t=t||1,this.isPaused()?this.playbackRate=t:(this.pause(),this.playbackRate=t,this.play())}},t.WebAudio.state={},t.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},t.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition}},t.WebAudio.state.finished={init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},t.util.extend(t.WebAudio,t.Observer),t.MediaElement=Object.create(t.WebAudio),t.util.extend(t.MediaElement,{init:function(t){this.params=t,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=t.mediaType.toLowerCase(),this.elementPosition=t.elementPosition,this.setPlaybackRate(this.params.audioRate),this.createTimer()},createTimer:function(){var t=this,e=function(){t.isPaused()||(t.fireEvent("audioprocess",t.getCurrentTime()),(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(e))};this.on("play",e)},load:function(t,e,i,a){var s=document.createElement(this.mediaType);s.controls=this.params.mediaControls,s.autoplay=this.params.autoplay||!1,s.preload=null==a?"auto":a,s.src=t,s.style.width="100%";var r=e.querySelector(this.mediaType);r&&e.removeChild(r),e.appendChild(s),this._load(s,i)},loadElt:function(t,e){var i=t;i.controls=this.params.mediaControls,i.autoplay=this.params.autoplay||!1,this._load(i,e)},_load:function(t,e){var i=this;"function"==typeof t.load&&t.load(),t.addEventListener("error",function(){i.fireEvent("error","Error loading media element")}),t.addEventListener("canplay",function(){i.fireEvent("canplay")}),t.addEventListener("ended",function(){i.fireEvent("finish")}),this.media=t,this.peaks=e,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var t=(this.buffer||this.media).duration;return t>=1/0&&(t=this.media.seekable.end(0)),t},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},getPlaybackRate:function(){return this.playbackRate||this.media.playbackRate},setPlaybackRate:function(t){this.playbackRate=t||1,this.media.playbackRate=this.playbackRate},seekTo:function(t){null!=t&&(this.media.currentTime=t),this.clearPlayEnd()},play:function(t,e){this.seekTo(t),this.media.play(),e&&this.setPlayEnd(e),this.fireEvent("play")},pause:function(){this.media&&this.media.pause(),this.clearPlayEnd(),this.fireEvent("pause")},setPlayEnd:function(t){var e=this;this.onPlayEnd=function(i){i>=t&&(e.pause(),e.seekTo(t))},this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(e,i,a){return this.buffer?t.WebAudio.getPeaks.call(this,e,i,a):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(t){this.media.volume=t},destroy:function(){this.pause(),this.unAll(),this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),t.AudioElement=t.MediaElement,t.Drawer={init:function(t,e,i,a){this.wavesurfer=a,this.container=t,this.params=e,this.aliases=i,this.width=0,this.height=e.height*this.params.pixelRatio,this.lastPos=0,this.initDrawer(e),this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(t,e){!e&&t.preventDefault();var i=t.targetTouches?t.targetTouches[0].clientX:t.clientX,a=this.wrapper.getBoundingClientRect(),s=this.width,r=this.getWidth();if(!this.params.fillParent&&s<r)var n=(i-a.left)*this.params.pixelRatiol,o=s-1;else var n=i-a.left+this.wrapper.scrollLeft,o=this.getScrollWidth()-1;return n>o?1:n/o||0},setupWrapperEvents:function(){var t=this;this.wrapper.addEventListener("click",function(e){var i=t.wrapper.offsetHeight-t.wrapper.clientHeight;if(0!=i){var a=t.wrapper.getBoundingClientRect();if(e.clientY>=a.bottom-i)return}t.params.interact&&t.fireEvent("click",e,t.handleEvent(e))}),this.wrapper.addEventListener("scroll",function(e){t.fireEvent("scroll",e)})},drawPeaks:t.util.frame(function(t,e,i,a,s){function r(t,e,i,a){function s(t,e){t[0]instanceof Array&&(t=t[0]),n[n.params.barWidth?"drawBars":"drawWave"](t,e,i,a)}if(n.params.splitChannels){var r=t;n.setHeight(r.length*n.params.height*n.params.pixelRatio),r.forEach(function(e,i){s(t,i)})}else s(t,0)}var n=this;n.setWidth(e),n.clearCanvas(),t instanceof Function?t(r):r(t,e,i,a),s&&s()}),style:function(t,e){return Object.keys(e).forEach(function(i){t.style[i]!==e[i]&&(t.style[i]=e[i])}),t},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(t){void 0===t&&(t=this.getCurrentProgress()),this.recenterOnPosition(t*this.getScrollWidth(),1)},recenterOnPosition:function(t,e){var i=t-this.wrapper.clientWidth/2;this.wrapper.scrollLeft=this.wrapper.scrollLeft*(1-e)+i*e||0},getScrollX:function(){return Math.round(this.wrapper.scrollLeft*this.params.pixelRatio)},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},getScrollWidth:function(){return this.wrapper.scrollWidth},setWidth:function(t){this.width!=t&&(this.width=t,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize())},setHeight:function(t){t!=this.height&&(this.height=t,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(t){var e=1/this.params.pixelRatio,i=Math.round(t*this.width)*e;if((i<this.lastPos||i-this.lastPos>=e)&&(this.lastPos=i,this.params.scrollParent&&this.params.autoCenter)){var a=~~(this.getScrollWidth()*t);this.recenterOnPosition(a,.8)}this.updateProgress(i)},destroy:function(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container&&this.container.removeChild(this.wrapper),this.wrapper=null)},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(t,e){},clearCanvas:function(){},updateProgress:function(t){},updateCursorPosition:function(t){},getCurrentPosition:function(){},getCurrentProgress:function(){}},t.util.extend(t.Drawer,t.Observer),t.Drawer.MultiCanvas=Object.create(t.Drawer),t.util.extend(t.Drawer.MultiCanvas,{initDrawer:function(t){if(this.maxCanvasWidth=null!=t.maxCanvasWidth?t.maxCanvasWidth:4e3,this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio),this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},createElements:function(){var e=this.params;["progressWave","wave"].forEach(function(t){this[t]=this.wrapper.appendChild(this.style(document.createElement("wave"),Object.assign({},e.styleList[t],{position:"absolute",zIndex:2,left:0,top:0,height:"100%",overflow:"hidden",width:"progressWave"==t?"0":"100%",boxSizing:"border-box",pointerEvents:"none"}))),e.classList[t]&&this[t].classList.add(e.classList[t]),"progressWave"==t&&(this[t].style.display="none")},this),this.cursor=this.wrapper.appendChild(this.style(document.createElement("div"),Object.assign({},e.styleList.cursor,{backgroundColor:e.cursorColor,position:"absolute",zIndex:2,width:e.cursorWidth+"px",height:"100%",left:0,display:"none"}))),t.util.refreshAliases(this.aliases,{cursorColor:{styleSource:{object:this.cursor.style,property:"backgroundColor"}},cursorWidth:{styleSource:{object:this.cursor.style,property:"width"},get:function(t){return parseFloat(t)},set:function(t){return t+"px"}}}),e.classList.cursor&&this.cursor.classList.add(e.classList.cursor),this.addCanvas()},updateSize:function(){for(var t=Math.round(this.width/this.params.pixelRatio),e=Math.ceil(t/this.maxCanvasElementWidth);this.canvases.length<e;)this.addCanvas();for(;this.canvases.length>e;)this.removeCanvas();this.canvases.forEach(function(t,e){if(e!=this.canvases.length-1)i=this.maxCanvasWidth+(this.invertTransparency?0:2*Math.ceil(this.params.pixelRatio/2));else var i=this.width-this.maxCanvasWidth*(this.canvases.length-1);this.updateDimensions(t,e,i,this.height),this.clearWaveType(t)},this)},addCanvas:function(){var t={},e=this.maxCanvasElementWidth*this.canvases.length;["progressWave","wave"].forEach(function(i){t[i]=this[i].appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:e+"px",top:this.invertTransparency?-this.halfPixel/2+"px":0,height:this.invertTransparency?"calc(100% + "+this.halfPixel+"px)":"100%"})),t[i+"Ctx"]=t[i].getContext("2d")},this),this.canvases.push(t)},removeCanvas:function(){var t=this.canvases.pop();t.wave.parentElement.removeChild(t.wave),t.progressWave&&t.progressWave.parentElement.removeChild(t.progressWave)},updateDimensions:function(t,e,i,a){var s=Math.round(i/this.params.pixelRatio),r=Math.round(this.width/this.params.pixelRatio);t.start=this.maxCanvasElementWidth*e/r,t.end=t.start+s/r,t.waveCtx.canvas.width=i,t.waveCtx.canvas.height=a,this.style(this.wave,{height:a/this.params.pixelRatio+"px"}),this.style(t.waveCtx.canvas,{width:s+"px"}),this.style(this.cursor,{display:"block"}),t.progressWaveCtx&&(this.style(this.progressWave,{height:a/this.params.pixelRatio+"px"}),t.progressWaveCtx.canvas.width=i,t.progressWaveCtx.canvas.height=a,this.style(t.progressWaveCtx.canvas,{width:s+"px"}),this.style(this.progressWave,{display:"block"}))},clearCanvas:function(){this.canvases.forEach(function(t){this.clearWaveType(t)},this)},clearWaveType:function(t){t.waveCtx.clearRect(0,0,t.waveCtx.canvas.width,t.waveCtx.canvas.height),t.progressWaveCtx&&t.progressWaveCtx.clearRect(0,0,t.progressWaveCtx.canvas.width,t.progressWaveCtx.canvas.height)},drawBars:function(e,i,a,s){var r=[].some.call(e,function(t){return t<0})?2:1,n=this.params.height*this.params.pixelRatio,o=n*i||0,h=n/2,c=e.length/r,l=this.params.barWidth*this.params.pixelRatio,u=l+Math.max(this.params.pixelRatio,~~(l/2));if(this.params.normalize)var d=t.util.max(e),p=t.util.min(e),f=-p>d?-p:d;else f=1/this.params.barHeight;var m=c/this.width;this.fillRect(0,0,this.width,n,"background");for(var v=a/m;v<s/m;v+=u){var g=e[Math.floor(v*m*r)]||0,y=Math.round(g/f*h);this.fillRect(v+this.halfPixel,h-y+o,l+this.halfPixel,2*y)}this.params.invertTransparency&&this.invertTransparency()},drawWave:function(e,i,a,s){if(![].some.call(e,function(t){return t<0})){for(var r=[],n=0,o=e.length;n<o;n++)r[2*n]=e[n],r[2*n+1]=-e[n];e=r}var h=this.params.height*this.params.pixelRatio,c=h*i||0,l=h/2;if(this.params.normalize)var u=t.util.max(e),d=t.util.min(e),p=-d>u?-d:u;else p=1/this.params.barHeight;this.fillRect(0,0,this.width,h,"background"),this.drawLine(e,p,l,c,a,s),this.fillRect(0,l+c-this.halfPixel,this.width,this.halfPixel),this.params.invertTransparency&&this.invertTransparency()},invertTransparency:function(){this.canvases.forEach(function(t){["wave"].concat(t.progressWaveCtx?["progressWave"]:[]).forEach(function(e){var i=t[e],a=document.createElement("canvas");a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0);var s=i.getContext("2d");s.fillStyle="wave"==e||void 0===this.params.progressColor?this.params.waveColor:this.params.progressColor,s.globalCompositeOperation="copy",s.fillRect(0,0,i.width,i.height),s.globalCompositeOperation="destination-out",s.drawImage(a,0,0),s.globalCompositeOperation="source-over"},this)},this)},drawLine:function(t,e,i,a,s,r){this.canvases.forEach(function(n){this.setFillStyles(n),this.drawLineToContext(n,n.waveCtx,t,e,i,a,s,r),this.drawLineToContext(n,n.progressWaveCtx,t,e,i,a,s,r)},this)},drawLineToContext:function(t,e,i,a,s,r,n,o){if(e){var h=i.length/2,c=this.params.fillParent&&this.width!=h?this.width/h:1,l=Math.round(h*t.start),u=Math.round(h*t.end)+1;if(!(l>o||u<n)){var d=Math.max(l,n),p=Math.min(u,o);e.beginPath(),e.moveTo((d-l)*c+this.halfPixel,s+r);for(v=d;v<p;v++){var f=i[2*v]||0,m=Math.round(f/a*s);e.lineTo((v-l)*c+this.halfPixel,s-m+r)}for(var v=p-1;v>=d;v--){var f=i[2*v+1]||0,m=Math.round(f/a*s);e.lineTo((v-l)*c+this.halfPixel,s-m+r)}e.closePath(),e.fill()}}},fillRect:function(t,e,i,a,s){for(var s=void 0===s?"foreground":s,r=Math.floor(t/this.maxCanvasWidth),n=Math.min(Math.ceil((t+i)/this.maxCanvasWidth)+1,this.canvases.length),o=r;o<n;o++){var h=this.canvases[o],c=o*this.maxCanvasWidth,l={x1:Math.max(t,o*this.maxCanvasWidth),y1:e,x2:Math.min(t+i,o*this.maxCanvasWidth+h.waveCtx.canvas.width),y2:e+a};l.x1<l.x2&&["wave"].concat(h.progressWaveCtx?["progressWave"]:[]).forEach(function(t){var e="wave"==t?"wave":"progress";"background"==s&&void 0===this.params[e+"BackgroundColor"]&&void 0===this.params.backgroundColor||(this.setFillStyles(h,t,s),this.fillRectToContext(h[t+"Ctx"],l.x1-c,l.y1,l.x2-l.x1,l.y2-l.y1))},this)}},fillRectToContext:function(t,e,i,a,s){t&&t.fillRect(e,i,a,s)},setFillStyles:function(t,e,i){var i=void 0===i?"foreground":i,a=this.params;if("foreground"==i){if(a.invertTransparency)var s="object"===a.invertTransparency&&"cutColor"in a.invertTransparency?a.invertTransparency.cutColor:"#fefefe";void 0!==e&&"wave"!=e||(t.waveCtx.fillStyle=a.invertTransparency?s:a.waveColor),void 0!==e&&"progressWave"!=e||!t.progressWaveCtx||(t.progressWaveCtx.fillStyle=a.invertTransparency?s:a.progressColor)}else void 0!==e&&"wave"!=e||(t.waveCtx.fillStyle=void 0!==a.waveBackgroundColor?a.waveBackgroundColor:a.backgroundColor),void 0!==e&&"progressWave"!=e||!t.progressWaveCtx||(t.progressWaveCtx.fillStyle=void 0!==a.progressBackgroundColor?a.progressBackgroundColor:a.backgroundColor)},updateProgress:function(t){void 0===t&&(t=this.getCurrentPosition());var e=this.width/this.params.pixelRatio;this.style(this.wave,{left:t+"px",width:e-t+"px"}),this.canvases.forEach(function(e,i){this.style(e.wave,{marginLeft:-t+"px"})},this),this.updateCursorPosition(t),this.progressWave&&this.style(this.progressWave,{width:t+"px"})},updateCursorPosition:function(t){void 0===t&&(t=this.getCurrentPosition());var e=t-("right"==this.params.cursorAlignment?0:"middle"==this.params.cursorAlignment?this.params.cursorWidth/2:this.params.cursorWidth);this.style(this.cursor,{left:e+"px"})},getCurrentPosition:function(){var t=this.wavesurfer.backend.getPlayedPercents();return 0===t&&0!=this.wavesurfer.lastClickPosition&&(t=this.wavesurfer.lastClickPosition),this.width/this.wavesurfer.params.pixelRatio*t},getCurrentProgress:function(){var t=this.wavesurfer.backend.getPlayedPercents();return 0===t&&0!=this.wavesurfer.lastClickPosition&&(t=this.wavesurfer.lastClickPosition),t},getScrollWidth:function(){return this.width/this.params.pixelRatio},getImage:function(t,e){var i=[];return this.canvases.forEach(function(a){i.push(a.wave.toDataURL(t,e))}),i.length>1?i:i[0]}}),t.Drawer.Canvas=Object.create(t.Drawer.MultiCanvas),t.util.extend(t.Drawer.Canvas,{initDrawer:function(t){if(this.maxCanvasWidth=null!=t.maxCanvasWidth?t.maxCanvasWidth:4e3,this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio),this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},updateSize:function(){this.maxCanvasWidth=this.width=this.getWidth(),this.maxCanvasElementWidth=Math.floor(this.maxCanvasWidth/this.params.pixelRatio);for(;this.canvases.length<1;)this.addCanvas();for(;this.canvases.length>1;)this.removeCanvas();this.canvases.forEach(function(t,e){this.updateDimensions(t,this.width,this.height),this.clearWaveType(t)},this)}}),t.Drawer.None=Object.create(t.Drawer),t.util.extend(t.Drawer.None,{initDrawer:function(t){if(this.maxCanvasWidth=null!=t.maxCanvasWidth?t.maxCanvasWidth:4e3,this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio),this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},createElements:function(){return[document.createElement("div")]},updateSize:function(){},addCanvas:function(){},removeCanvas:function(){},updateDimensions:function(t,e,i){},clearCanvas:function(){},clearWaveType:function(t){},drawBars:function(t,e,i,a){},drawWave:function(t,e,i,a){},drawLine:function(t,e,i,a,s,r){},drawLineToContext:function(t,e,i,a,s,r,n,o){},fillRect:function(t,e,i,a){},fillRectToContext:function(t,e,i,a,s){},setFillStyles:function(t){},updateProgress:function(t){},getImage:function(t,e){}}),t.Drawer.SplitWavePointPlot=Object.create(t.Drawer.Canvas),t.util.extend(t.Drawer.SplitWavePointPlot,{defaultPlotParams:{plotNormalizeTo:"whole",plotTimeStart:0,plotMin:0,plotMax:1,plotColor:"#f63",plotProgressColor:"#F00",plotPointHeight:2,plotPointWidth:2,plotSeparator:!0,plotSeparatorColor:"black",plotRangeDisplay:!1,plotRangeUnits:"",plotRangePrecision:4,plotRangeIgnoreOutliers:!1,plotRangeFontSize:12,plotRangeFontType:"Ariel",waveDrawMedianLine:!0,plotFileDelimiter:"\t"},plotTimeStart:0,plotTimeEnd:-1,plotArrayLoaded:!1,plotArray:[],plotPoints:[],plotMin:0,plotMax:1,initDrawer:function(t){var e=this;for(var i in this.defaultPlotParams)void 0===this.params[i]&&(this.params[i]=this.defaultPlotParams[i]);if(this.plotTimeStart=this.params.plotTimeStart,void 0!==this.params.plotTimeEnd&&(this.plotTimeEnd=this.params.plotTimeEnd),Array.isArray(t.plotArray))this.plotArray=t.plotArray,this.plotArrayLoaded=!0;else{var a=function(t){e.plotArray=t,e.plotArrayLoaded=!0,e.fireEvent("plot_array_loaded")};this.loadPlotArrayFromFile(t.plotFileUrl,a,this.params.plotFileDelimiter)}},drawPeaks:function(t,e,i,a){if(1==this.plotArrayLoaded)this.setWidth(e),this.splitChannels=!0,this.params.height=this.params.height/2,t[0]instanceof Array&&(t=t[0]),this.params.barWidth?this.drawBars(t,1,i,a):this.drawWave(t,1,i,a),this.params.height=2*this.params.height,this.calculatePlots(),this.drawPlots();else{var s=this;s.on("plot-array-loaded",function(){s.drawPeaks(t,e,i,a)})}},drawPlots:function(){var t=this.params.height*this.params.pixelRatio/2,e=.5/this.params.pixelRatio;this.waveCc.fillStyle=this.params.plotColor,this.progressCc&&(this.progressCc.fillStyle=this.params.plotProgressColor);for(var i in this.plotPoints){var a=parseInt(i),s=t-this.params.plotPointHeight-this.plotPoints[i]*(t-this.params.plotPointHeight),r=this.params.plotPointHeight;this.waveCc.fillRect(a,s,this.params.plotPointWidth,r),this.progressCc&&this.progressCc.fillRect(a,s,this.params.plotPointWidth,r)}this.params.plotSeparator&&(this.waveCc.fillStyle=this.params.plotSeparatorColor,this.waveCc.fillRect(0,t,this.width,e)),this.params.plotRangeDisplay&&this.displayPlotRange()},displayPlotRange:function(){var t=this.params.plotRangeFontSize*this.params.pixelRatio,e=this.plotMax.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits,i=this.plotMin.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits;this.waveCc.font=t.toString()+"px "+this.params.plotRangeFontType,this.waveCc.fillText(e,3,t),this.waveCc.fillText(i,3,this.height/2)},calculatePlots:function(){this.plotPoints={},this.calculatePlotTimeEnd();for(var t=[],e=-1,i=0,a=99999999999999,s=0,r=99999999999999,n=this.plotTimeEnd-this.plotTimeStart,o=0;o<this.plotArray.length;o++){var h=this.plotArray[o];if(h.value>i&&(i=h.value),h.value<a&&(a=h.value),h.time>=this.plotTimeStart&&h.time<=this.plotTimeEnd){var c=Math.round(this.width*(h.time-this.plotTimeStart)/n);if(t.push(h.value),c!==e&&t.length>0){var l=this.avg(t);l>s&&(s=l),l<r&&(r=l),this.plotPoints[e]=l,t=[]}e=c}}"whole"==this.params.plotNormalizeTo?(this.plotMin=a,this.plotMax=i):"values"==this.params.plotNormalizeTo?(this.plotMin=this.params.plotMin,this.plotMax=this.params.plotMax):(this.plotMin=r,this.plotMax=s),this.normalizeValues()},normalizeValues:function(){var t={};if("none"!==this.params.plotNormalizeTo){for(var e in this.plotPoints){var i=(this.plotPoints[e]-this.plotMin)/(this.plotMax-this.plotMin);i>1?this.params.plotRangeIgnoreOutliers||(t[e]=1):i<0?this.params.plotRangeIgnoreOutliers||(t[e]=0):t[e]=i}this.plotPoints=t}},loadPlotArrayFromFile:function(e,i,a){void 0===a&&(a="\t");var s=[],r={url:e,responseType:"text"};t.util.ajax(r).on("load",function(t){if(200==t.currentTarget.status){for(var e=t.currentTarget.responseText.split("\n"),r=0;r<e.length;r++){var n=e[r].split(a);2==n.length&&s.push({time:parseFloat(n[0]),value:parseFloat(n[1])})}i(s)}})},calculatePlotTimeEnd:function(){void 0!==this.params.plotTimeEnd?this.plotTimeEnd=this.params.plotTimeEnd:this.plotTimeEnd=this.plotArray[this.plotArray.length-1].time},avg:function(t){return t.reduce(function(t,e){return t+e})/t.length}}),t.util.extend(t.Drawer.SplitWavePointPlot,t.Observer),t.PeakCache={init:function(){this.clearPeakCache()},clearPeakCache:function(){this.peakCacheRanges=[],this.peakCacheLength=-1},addRangeToPeakCache:function(t,e,i){t!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=t);for(var a=[],s=0;s<this.peakCacheRanges.length&&this.peakCacheRanges[s]<e;)s++;for(s%2==0&&a.push(e);s<this.peakCacheRanges.length&&this.peakCacheRanges[s]<=i;)a.push(this.peakCacheRanges[s]),s++;s%2==0&&a.push(i),a=a.filter(function(t,e,i){return 0==e?t!=i[e+1]:e==i.length-1?t!=i[e-1]:t!=i[e-1]&&t!=i[e+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(a),this.peakCacheRanges=this.peakCacheRanges.sort(function(t,e){return t-e}).filter(function(t,e,i){return 0==e?t!=i[e+1]:e==i.length-1?t!=i[e-1]:t!=i[e-1]&&t!=i[e+1]});var r=[];for(s=0;s<a.length;s+=2)r.push([a[s],a[s+1]]);return r},getCacheRanges:function(){for(var t=[],e=0;e<this.peakCacheRanges.length;e+=2)t.push([this.peakCacheRanges[e],this.peakCacheRanges[e+1]]);return t}},function(){var e=function(){var e=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(e,function(e){var i=t.util.extend({container:e,backend:"MediaElement",mediaControls:!0},e.dataset);e.style.display="block";var a=t.create(i);if(e.dataset.peaks)var s=JSON.parse(e.dataset.peaks);a.load(e.dataset.url,s)})};"complete"===document.readyState?e():window.addEventListener("load",e)}(),t});
